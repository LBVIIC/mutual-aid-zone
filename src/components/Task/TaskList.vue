<template>
    <div>
        <div class="task_content">
            <h2>{{item.title}}</h2>
            <div class="task_detail">{{item.content}}</div>
            <ul class="task_sub">
                <li class="task_phone">用户: {{item.task_setter}}</li>
                <li class="price">出价: {{item.price}}元</li>
                <li class="task_type">类型: {{taskType}}</li>
            </ul>
            <ul class="task_sub">
                <li class="time">{{time}}</li>
                <li class="task_id">任务号: {{item.id}}号</li>
                <li class="btn" @click="btnMethods">{{ btnType }}</li>
            </ul>
        </div>
    </div>
</template>

<script>
export default {
    name: "TaskList",
    // item用于接受每一条任务的数据
    // type用于区分 所有任务、我的任务、我发布的
    props: ["item", "type"],
    methods: {
        // 实现任务的接受、删除、放弃
        btnMethods() {
            this.$http
                .get(
                    "/taskEdit",
                    // type=0代表接受任务
                    // type=1代表放弃任务
                    // type=2代表删除任务
                    {
                        params: { id: this.item.id, type: this.type },
                        headers: { token: localStorage.getItem("token") },
                    }
                )
                .then((res) => {
                    if (this.type === 0) {
                        alert("接受成功");
                        this.$router.push("/task");
                    } else if (this.type === 1) {
                        alert("放弃成功");
                        this.$router.go(0);
                    } else {
                        alert("删除成功");
                        this.$router.go(0);
                    }
                });
        },
    },
    emits: ["change"],
    computed: {
        // 格式化类型
        taskType() {
            switch (this.item.type) {
                case "express":
                    return "拿快递";
                case "borrow":
                    return "借东西";
                case "sale":
                    return "卖二手";
                case "study":
                    return "一起学习";
            }
        },

        // 格式化时间
        time() {
            let date = new Date(this.item.createdAt);
            let month = date.getMonth() + 1;
            let day = date.getDate();
            let hour = date.getHours();
            let minute = date.getMinutes();
            return `${month}月${day}日 ${hour}:${minute}`;
        },

        // 动态渲染按钮类型
        btnType() {
            switch (this.type) {
                case 0:
                    return "接受";
                case 1:
                    return "放弃";
                case 2:
                    return "删除";
            }
        },
    },
};
</script>

<style scoped>
.task_content {
    height: 12rem;
    width: 100%;
    margin: 1rem 0 0 0;
    background-color: #fff;
    border-radius: 2%;
    box-sizing: border-box;
    box-shadow: #666 0px 0px 3px;
    padding: 16px;
}

.task_content h2 {
    font-weight: 700;
    font-size: 1.3rem;
}

.task_detail {
    height: 4.5rem;
    margin: 0.5rem 0;
}

.task_sub {
    display: flex;
    justify-content: space-between;
}

.task_sub .abandon,
.task_sub .delete,
.task_sub .get {
    cursor: pointer;
    color: #950040;
}

.btn {
    color: #950040;
}
</style>